/*! @bluemango/slp-helper v1.5.3 - 2018/05/08 */
!function(e){function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var t={};r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=0)}([function(e,r,t){"use strict";function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};window.lemonpi=window.lemonpi||[],function(){var e="padding:1px 6px 0;border-radius:2px;background:#fbde00;color:#444",r={booleans:["available"],numbers:["advertiserId","dynamicInputId"],strings:["category","clickUrl","custom1","custom2","custom3","custom4","description","expiresOn","id","imageUrl","logoUrl","priceDiscount","priceNormal","stickerText","title","type"],required:["advertiserId","dynamicInputId","imageUrl","title"]},t=r.booleans.concat(r.numbers,r.strings),s={debug:/lemonpi_debug/.test(window.location.href),optionalFields:[],interval:500},a=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];for(var o=JSON.stringify(r),n=0,i=void 0,s=0;s<o.length;s+=1)i=o.charCodeAt(s),n=(n<<5)-n+i,n|=0;return n.toString()},c=function(e){var r=e;if("string"==typeof e&&(r=document.querySelector(e)),r){var t=window.getComputedStyle(r).getPropertyValue("background-image").replace(/url\(['"]?|['"]?\)/g,"");return"none"===t?void 0:t}},l=function(r,t){console.log("%cSLP%c "+r+"%c "+t,e,"color:red;font-weight:bold","color:red")},u=function(e){return window.location.pathname.split("/").filter(function(e){return e}).map(function(e){return decodeURI(e)})[e]},d=function(e){return window.location.search.replace(/^\?/,"").split("&").filter(function(e){return e}).reduce(function(e,r){return i(e,o({},decodeURI(r.split("=")[0]),decodeURI(r.split("=")[1])))},{})[e]},f=function(e){var r=window.location.protocol+"//"+window.location.host+window.location.pathname;if(e){var t=!1;if(e.allowedParameters&&e.allowedParameters.length&&e.allowedParameters.forEach(function(e){var o=t?"&":"?",n=encodeURI(e),i=d(e);void 0!==i&&(r+=""+o+n+"="+encodeURI(i),t=!0)}),e.customParameters){Object.keys(e.customParameters).forEach(function(o){var n=t?"&":"?",i=encodeURI(o),s=encodeURI(e.customParameters[o]);r+=""+n+i+"="+s,t=!0})}e.hash&&(r+=window.location.hash)}return r},p=function(o,c){var u=this;if(this.config=i({},s),this.input=o,this.callback=c,this.result={},this.errors=[],this.pointerCoords=[],this.lastScrapedHash="",this.interactedStateHash="",this.getUserInteracted=function(){var e=document.body.getBoundingClientRect(),r=a(e,u.pointerCoords);return u.interactedStateHash!==r&&(u.interactedStateHash=r,!0)},this.handleFunction=function(e,r){var t=void 0;try{t=r()}catch(r){u.errors[e]||-1!==u.config.optionalFields.indexOf(e)||(u.errors[e]=r.message)}return t},this.getValue=function(e,t){var o=t;switch("function"==typeof o&&(o=u.handleFunction(e,o)),void 0===o?"undefined":n(o)){case"boolean":u.errors[e]||-1!==r.booleans.indexOf(e)||(u.errors[e]="doesn't expect a boolean value");break;case"number":u.errors[e]||-1!==r.numbers.indexOf(e)||(u.errors[e]="doesn't expect a number value");break;case"string":switch(o=o.replace(/\s+/g," ").trim(),u.errors[e]||-1!==r.strings.indexOf(e)||(u.errors[e]="doesn't expect a string value"),e){case"category":case"id":;o=o.toLowerCase().replace(/[^\da-z]/g,function(e){return"aaaaaaoooooooeeeecdiiiiuuuuunsyyz"["àáâãäåòóôõöőøèéêëçðìíîïùúûüűñšÿýž".indexOf(e)]||" "}).trim().replace(/\s+/g,"-");break;case"clickUrl":case"imageUrl":case"logoUrl":u.errors[e]||/^https?:\/\//.test(o)||(u.errors[e]="should be a URL and start with 'http://' or 'https://'");break;case"expiresOn":u.errors[e]||"Invalid Date"!==new Date(o).toString()||(u.errors[e]="should be an ISO 8601 formatted datetime string");break;case"type":u.errors[e]||-1!==["propInBasket","propPurchased","propSeen"].indexOf(o)||(u.errors[e]="should be 'propSeen', 'propInBasket', or 'propPurchased'")}break;case"undefined":-1!==u.config.optionalFields.indexOf(e)||u.errors[e]||(u.errors[e]="is undefined");break;default:u.errors[e]||(u.errors[e]="can't be of type "+(void 0===o?"undefined":n(o)))}return o},this.scrape=function(){u.result={},u.errors={},Object.keys(u.input).forEach(function(e){-1!==t.indexOf(e)&&(u.result[e]=u.getValue(e,u.input[e]))}),Object.keys(u.result).forEach(function(e){void 0!==u.result[e]&&""!==u.result[e]||(delete u.result[e],u.errors[e]||-1!==u.config.optionalFields.indexOf(e)||(u.errors[e]="is empty"))}),-1!==["propInBasket","propPurchased"].indexOf(u.result.type)&&(r.required=["id","advertiserId","dynamicInputId"]),r.required.forEach(function(e){u.errors[e]||-1!==Object.keys(u.result).indexOf(e)||(u.errors[e]="is required and missing")});var o=a(u.result);if(o!==u.lastScrapedHash||u.config.longestViewed&&u.getUserInteracted())if(u.lastScrapedHash=o,u.result.type||(u.result.type="propSeen"),"propSeen"===u.result.type&&(u.result.id||(u.result.id=o),u.result.category||(u.result.category="none"),void 0===u.result.available&&(u.result.available=!0),u.result.clickUrl||(u.result.clickUrl=f())),u.config.debug&&Object.keys(u.errors).forEach(function(e){l(e,u.errors[e])}),Object.keys(u.errors).length)u.config.debug&&console.log("%cSLP%c Scrape unsuccessful:",e,"color:red",u.result);else{if(u.config.debug&&console.log("%cSLP%c Scrape successful:",e,"color:green",u.result),u.callback?u.callback(u.result):window.lemonpi.push(u.result),!u.config.watchChanges&&!u.config.longestViewed)return;u.input.config.longestViewed&&(u.config.interval=5e3)}setTimeout(function(){u.scrape()},u.config.interval)},this.input.config&&(this.input.config.longestViewed&&document.addEventListener("mousemove",function(e){u.pointerCoords=[e.pageX,e.pageY]}),i(this.config,this.input.config),this.config.testUrl&&this.config.testUrl.test&&!this.config.testUrl.test(window.location.href)))return void(this.config.debug&&l("The URL","doesn't match '"+this.config.testUrl.toString()+"'"));this.scrape()};window.slp=window.slp||{getBackgroundImageUrl:c,getUrlQueryParameter:d,getUrlPathSegment:u,generateHash:a,getUrl:f,scrape:function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return new(Function.prototype.bind.apply(p,[null].concat(r)))}}}()}]);
